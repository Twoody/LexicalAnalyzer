# Makefile

################################################################
# File dependencies in the Kestrel compiler
# Author: D. W. Jones
# Instructions:
#          make         -- will build the Kestrel compiler (later)
#          make testlex -- build the testlex test framework
#          make clean   -- delete all files generated by make
################################################################

#######
# configuration options

# compiler to use
COMPILER = gcc -std=c99  #Without c99, we get '.h.gch' file when 'make testlex' is called from cmd line

#lexical contains: lexical, stringpool, keywords, symboltable
#######
# primary make target: the kestrel compiler

kestrel: main.o lexical.o symboltable.o stringpool.o errors.o
	echo error cannot make kestrel yet

lexical.o: lexical.c lexical.h symboltable.h stringpool.h errors.h config.h sets.h
	$(COMPILER) -o lexical.o -c lexical.c

symboltable.o: symboltable.c symboltable.h stringpool.h config.h
	$(COMPILER) -o symboltable.o -c symboltable.c

stringpool.o: stringpool.c stringpool.h config.h errors.h
	$(COMPILER) -o stringpool.o -c stringpool.c

errors.o: errors.h
	$(COMPILER) -o errors.o -c errors.c

######
# secondary make target: testlex, to test the lexical analyzer

testlex: testlex.o lexical.o symboltable.o stringpool.o errors.o
	$(COMPILER)  -o testlex testlex.o lexical.o errors.o symboltable.o stringpool.o
	echo Made testlex

testlex.o: testlex.c lexical.h symboltable.h stringpool.h config.h
	$(COMPILER)  -c testlex.c

######
# secondary make target: clean for cleaning up the project

clean:
	rm *.o
	rm testlex
	rm kestrel
